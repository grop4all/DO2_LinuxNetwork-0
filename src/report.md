## Report


1. [Содержание](#chapter-iii) \
   3.1. [Инструмент ipcalc](#part-1-инструмент-ipcalc) \
   3.2. [Статическая маршрутизация между двумя машинами](#part-2-статическая-маршрутизация-между-двумя-машинами) \
   3.3. [Утилита iperf3](#part-3-утилита-iperf3) \
   3.4. [Сетевой экран](#part-4-сетевой-экран) \
   3.5. [Статическая маршрутизация сети](#part-5-статическая-маршрутизация-сети) \
   3.6. [Динамическая настройка IP с помощью DHCP](#part-6-динамическая-настройка-ip-с-помощью-dhcp) \
   3.7. [NAT](#part-7-nat) \
   3.8. [Допополнительно. Знакомство с SSH Tunnels](#part-8-дополнительно-знакомство-с-ssh-tunnels)


## Part 1. Инструмент **ipcalc**
`-` Итак, начнём наше погружение в удивительный мир сетей со знакомства с IP адресами. А использовать для этого мы будем инструмент **ipcalc**.

#### 1.1. Сети и маски
##### Определить и записать в отчёт:
##### 1) Адрес сети *192.167.38.54/13*
![ipcalc](images/1.png)

##### 2) Перевод маски *255.255.255.0* в префиксную и двоичную запись
![mask](images/2.png)
##### */15* в обычную и двоичную,
![mask](images/3.png)
#### *11111111.11111111.11111111.11110000* в обычную и префиксную
![mask](images/4.png)
##### 3) Минимальный и максимальный хост в сети *12.167.38.4* при масках: */8*, *11111111.11111111.00000000.00000000*, *255.255.254.0* и */4*
![*12.167.38.4/8*](images/5.png)
![*12.167.38.4/16*](images/6.png)
![*12.167.38.4/23*](images/7.png)
![*12.167.38.4/4*](images/8.png)

#### 1.2. localhost
##### Определить и записать в отчёт, можно ли обратиться к приложению, работающему на localhost, со следующими IP: *194.34.23.100*, *127.0.0.2*, *127.1.0.1*, *128.0.0.1* 
#### - *127.0.0.0* — *127.255.255.255* (Reserved for loopback interfaces (not used for communication between network nodes), so called localhost)
- следовательно только *127.0.0.2*, *127.1.0.1*



### 1.3. Диапазоны и сегменты сетей
#### Определить и записать в отчёт:
#### 1) какие из перечисленных IP можно использовать в качестве публичного, а какие только в качестве частных: *10.0.0.45*, *134.43.0.2*, *192.168.4.2*, *172.20.250.4*, *172.0.2.1*, *192.172.0.1*, *172.68.0.2*, *172.16.255.255*, *10.10.10.10*, *192.169.168.1*
Существуют классификации IP-адресов как «частные» и «публичные». Следующие диапазоны адресов зарезервированы для частных (также известных как LAN) сетей: \
10.0.0.0 — 10.255.255.255 ( 10.0.0.0/8 ),\
172.16.0.0 — 172.31.255.255 ( 172.16.0.0/12 ), \
192.168.0.0 — 192.168.255.255 ( 192.168.0.0/16 ). \
127.0.0.0 — 127.255.255.255 (Зарезервировано для петлевых интерфейсов (не используется для связи между узлами сети), так называемый localhost)
- Следовательно частные :*10.0.0.45*, *192.168.4.2*, *172.20.250.4*, *172.16.255.255*, *192.169.168.1*, *10.10.10.10*
- публичные : *134.43.0.2*,  *172.0.2.1*, *192.172.0.1*, *172.68.0.2*

#### 2) какие из перечисленных IP адресов шлюза возможны у сети *10.10.0.0/18*: *10.0.0.1*, *10.10.0.2*, *10.10.10.10*, *10.10.100.1*, *10.10.1.255*
- *10.10.0.2*, *10.10.10.10*, *10.10.1.255* *10.10.100.1*

## Part 2. Статическая маршрутизация между двумя машинами


#### С помощью команды `ip a` посмотреть существующие сетевые интерфейсы
- В отчёт поместить скрин с вызовом и выводом использованной команды.
![](images/11ws2.png)
##### Описать сетевой интерфейс, соответствующий внутренней сети, на обеих машинах и задать следующие адреса и маски: ws1 - *192.168.100.10*, маска */16*, ws2 - *172.24.116.8*, маска */12*
- В отчёт поместить скрины с содержанием изменённого файла *etc/netplan/00-installer-config.yaml* для каждой машины.
![](images/9ws2.png)
![](images/10ws1.png)
#### 2.1. Добавление статического маршрута вручную
##### Добавить статический маршрут от одной машины до другой и обратно при помощи команды вида `ip r add`
##### Пропинговать соединение между машинами
- В отчёт поместить скрин с вызовом и выводом использованных команд.
![](images/13ws2.png)
![](images/14ws1.png)
#### 2.2. Добавление статического маршрута с сохранением
##### Перезапустить машины
##### Добавить статический маршрут от одной машины до другой с помощью файла *etc/netplan/00-installer-config.yaml*
- В отчёт поместить скрин с содержанием изменённого файла *etc/netplan/00-installer-config.yaml*.
![](images/15ws2.png)
![](images/16ws1.png)
##### Пропинговать соединение между машинами
- В отчёт поместить скрин с вызовом и выводом использованной команды.
![](images/17ws1.png)
![](images/18ws2.png)
## Part 3. Утилита **iperf3**
#### 3.1. Скорость соединения
##### Перевести и записать в отчёт: 8 Mbps = 8,38 MB/s, 100 MB/s 95,36 Kbps, 1 Gbps = 1024 Mbps

#### 3.2. Утилита **iperf3**
##### Измерить скорость соединения между ws1 и ws2
- В отчёт поместить скрины с вызовом и выводом использованных команд.
![](images/19ws1.png)
## Part 4. Сетевой экран


-ws2 ![](images/21ws2.png)
-ws1 ![](images/23ws1.png)
Если сначала ACCEPT то с хоста с которого пигуют увидят что пакет дошел


#### 4.2. Утилита **nmap**
##### Командой **ping** найти машину, которая не "пингуется", после чего утилитой **nmap** показать, что хост машины запущен
*Проверка: в выводе nmap должно быть сказано: `Host is up`*
- В отчёт поместить скрины с вызовом и выводом использованных команд **ping** и **nmap**.
![](images/25ws2.png)
![](images/26ws1.png)
![](images/27ws2.png)
![](images/28ws2.png)

## Part 5. Статическая маршрутизация сети

`-` Пока что мы соединяли всего две машины, но теперь пришло время для статической маршрутизации целой сети.

**== Задание ==**

Сеть: \
<img src="misc/images/part5_network.png" alt="part5_network" width="500"/>

##### Поднять пять виртуальных машин (3 рабочие станции (ws11, ws21, ws22) и 2 роутера (r1, r2))

#### 5.1. Настройка адресов машин
##### Настроить конфигурации машин в *etc/netplan/00-installer-config.yaml* согласно сети на рисунке.
- В отчёт поместить скрины с содержанием файла *etc/netplan/00-installer-config.yaml* для каждой машины.
![](images/30ws22.png)
![](images/31ws21.png)
![](images/36ws11_yaml.png)
![](images/41r2_yaml.png)
![](images/38r1_yaml.png)
##### Перезапустить сервис сети. Если ошибок нет, то командой `ip -4 a` проверить, что адрес машины задан верно. Также пропинговать ws22 с ws21. Аналогично пропинговать r1 с ws11.
- В отчёт поместить скрины с вызовом и выводом использованных команд.
![](images/32ws21.png)
![](images/33ws22.png)
![](images/40ws11_ping.png)
![](images/34ws21tows22.png)
![](images/37ws11_ip.png)
![](images/39r1_ip.png)
![](images/42r2_ip.png)
![](images/43r1_ipforw.png)

#### 5.2. Включение переадресации IP-адресов.
##### Для включения переадресации IP, выполните команду на роутерах:
![](images/44r2_ipforw.png)
![](images/45r2_conf.png)

#### 5.3. Установка маршрута по-умолчанию
Пример вывода команды `ip r` после добавления шлюза:
```
default via 10.10.0.1 dev eth0
10.10.0.0/18 dev eth0 proto kernel scope link src 10.10.0.2
```
##### Настроить маршрут по-умолчанию (шлюз) для рабочих станций. Для этого добавить `default` перед IP роутера в файле конфигураций
- В отчёт поместить скрин с содержанием файла *etc/netplan/00-installer-config.yaml*.
![](images/47ws11_defauilt.png)
##### Вызвать `ip r` и показать, что добавился маршрут в таблицу маршрутизации
- В отчёт поместить скрин с вызовом и выводом использованной команды.
##### Пропинговать с ws11 роутер r2 и показать на r2, что пинг доходит. Для этого использовать команду:
`tcpdump -tn -i eth1`
- В отчёт поместить скрин с вызовом и выводом использованных команд.
![](images/49ping.png)
#### 5.4. Добавление статических маршрутов
##### Добавить в роутеры r1 и r2 статические маршруты в файле конфигураций. 

![](images/50_r2_5.4.png)
![](images/51_r2_5.4.png)

##### Вызвать `ip r` и показать таблицы с маршрутами на обоих роутерах. Пример таблицы на r1:
![](images/48ws11_ipr.png)
![](images/79_ipr.png)
- В отчёт поместить скрин с вызовом и выводом использованных команд.
- В отчёте объяснить, почему для адреса 10.10.0.0/\[маска сети\] был выбран маршрут, отличный от 0.0.0.0/0, хотя он попадает под маршрут по-умолчанию.
![](images/53_ws11_5.4.png)
![](images/54_ws115.4.png)
#### 5.5. Построение списка маршрутизаторов
Пример вывода утилиты **traceroute** после добавления шлюза:
![](images/55_ws11_trace.png)
##### Запустить на r1 команду дампа:
`tcpdump -tnv -i eth0`
![](images/80.png)

#### 5.6. Использование протокола **ICMP** при маршрутизации
##### Запустить на r1 перехват сетевого трафика, проходящего через eth0 с помощью команды:
`tcpdump -n -i eth0 icmp`
##### Пропинговать с ws11 несуществующий IP (например, *10.30.0.111*) с помощью команды:
`ping -c 1 10.30.0.111`
![](images/57_ws11_5.6.png)
![](images/58_r1_5.6.png)

##### Сохранить дампы образов виртуальных машин
**p.s. Ни в коем случае не сохранять дампы в гит!**

## Part 6. Динамическая настройка IP с помощью **DHCP**

`-` Следующим нашим шагом будет более подробное знакомство со службой **DHCP**, которую ты уже знаешь.

**== Задание ==**

*В данном задании используются виртуальные машины из Части 5*

##### Для r2 настроить в файле */etc/dhcp/dhcpd.conf* конфигурацию службы **DHCP**:
![](images/59_r2_dchp_6.1.png)
![](images/59_r2_dchp_6.1.png)
![](images/60_r2_dhcp_6.1.png)
![](images/61_ws21_ipa_6.1.png)
##### Указать MAC адрес у ws11, для этого в *etc/netplan/00-installer-config.yaml* надо добавить строки: `macaddress: 10:10:10:10:10:BA`, `dhcp4: true`
![](images/63_ws11_yaml.png)
##### Для r1 настроить аналогично r2, но сделать выдачу адресов с жесткой привязкой к MAC-адресу (ws11). Провести аналогичные тесты
![](images/65_r1_conf.png)
![](images/64_ws11_ipa.png)
![](images/66_ws21_ipa.png)

## Part 7. **NAT**

##### В файле */etc/apache2/ports.conf* на ws22 и r1 изменить строку `Listen 80` на `Listen 0.0.0.0:80`, то есть сделать сервер Apache2 общедоступным
![](images/67_apache_7.0.png)
аналогично на ws11

##### Запустить веб-сервер Apache командой `service apache2 start` на ws22 и r1
![](images/68_apach_run_r1.png)
аналогично на ws11
![](images/81.png)
потому что policy FORWARD DROP
![](images/70_r1_ping.png)
![](images/71_r2_firewall.png)

##### Проверить соединение по TCP для **SNAT**, для этого с ws22 подключиться к серверу Apache на r1 командой:
![](images/73_ws22_r1.png)
![](images/74_tcpdump.png)
![](images/76_r1.png)
![](images/75_tcpdumpws22.png)


## Part 8. Дополнительно. Знакомство с **SSH Tunnels**

![](images/77_localhost_port.png)
![](images/78_ssh.png)

